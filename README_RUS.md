# Таблица валют SQL

## _Data Warehouse_

Резюме: Сегодня вы узнаете, что такое DWH и как создать первый процесс ETL.

## Содержание

1. [Глава I] (#глава-i) \
    1.1. [Преамбула] (#preamble)
2. [Глава II] (#глава-ii) \
    2.1. [Инструкции] (#instructions)
3. [Глава III] (#глава-iii) \
    3.1. [Упражнение 00 - Классическая DWH] (#упражнение-00-классическая dwh)  
4. [Глава IV] (#глава-iv) \
    4.1. [Упражнение 01 - Подробный запрос] (#упражнение-01-подробный запрос)  

## Глава I
## Преамбула

![T01_01](misc/images/DWH.png)

Data Warehousing (DWH) - это процесс сбора данных из разрозненных источников и управления ими для получения значимой бизнес-информации. DWH обычно используется для соединения и анализа бизнес-данных из разнородных источников. DWH является ядром BI-системы, созданной для анализа данных и составления отчетов.

## Глава II
## Инструкции

Пожалуйста, загрузите [скрипт](src/database/model.sql) с моделью базы данных здесь и примените скрипт к своей базе данных

Пожалуйста, взгляните на логический вид нашей модели базы данных.

![T01_06](misc/images/tables.png)

## Глава III
## Упражнение 00 Классическое DWH

Давайте взглянем на источники данных и первый логический уровень данных (ODS - хранилище операционных данных) в DWH.

![T01_06](misc/images/ODS.png)

Пожалуйста, напишите инструкцию SQL, которая возвращает общий объем (сумму всех денежных средств) транзакций с баланса пользователя, агрегированный по пользователю и типу баланса. Обратите внимание, что все данные должны быть обработаны, включая данные с аномалиями. 

## Глава IV
## Упражнение 01 Подробный запрос

Прежде чем углубиться в выполнение этой задачи, пожалуйста, примените следующие инструкции INSERT.

`insert into currency values (100, 'EUR', 0.85, '2022-01-01 13:29');`
`insert into currency values (100, 'EUR', 0.79, '2022-01-08 13:29');`

Пожалуйста, напишите SQL-запрос, который возвращает всех пользователей, все балансовые транзакции (в этой задаче, пожалуйста, игнорируйте валюты, у которых нет ключа в таблице `Currency`) с названием валюты и расчетной стоимостью валюты в долларах США на следующий день.

![T01_06](misc/images/currency.png)

- Вам нужно найти ближайший курс_то_usd валюты в прошлом (t1).
- Если t1 пуст (означает отсутствие курсов в прошлом), то найдите ближайший курс_то_usd валюты в будущем (t2).
- Используйте курс t1 Или t2 для расчета валюты в формате USD.

Отсортируйте результат по имени пользователя в порядке убывания, а затем по фамилии пользователя и названию валюты в порядке возрастания.
